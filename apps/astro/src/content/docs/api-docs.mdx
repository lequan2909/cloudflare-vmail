---
title: API Documentation
description: Complete API reference for Cloudflare VMail services
---

# Cloudflare VMail API Documentation

Welcome to the Cloudflare VMail API documentation. Our service provides a comprehensive set of endpoints for email management, automation, and system administration.

## Authentication

All private API endpoints require authentication via Header.

- **Header**: `X-API-Key`
- **Value**: Your configured `API_KEY` in `wrangler.toml`.

---

## ðŸ”§ Management Endpoints

### 1. Manual Cleanup
Trigger the cleanup routine immediately. This is useful for manual maintenance or testing.
- **URL**: `GET /api/v1/cleanup`
- **Auth**: Required
- **Response**:
  ```json
  {
    "success": true,
    "message": "Cleanup routine executed."
  }
  ```

### 2. Send Email
Send an email using the configured 3rd-party provider (e.g., Resend, SendGrid).
- **URL**: `POST /api/v1/send`
- **Auth**: Required
- **Body**:
  ```json
  {
    "to": "recipient@example.com",
    "subject": "Hello from VMail",
    "content": "<p>This is an HTML email</p>",
    "from": "Sender Name <sender@your-domain.com>" // Optional
  }
  ```

---

## ðŸ“¬ Inbox Endpoints (Automation)

### 3. Get Latest Email
Ideally used for automation scenarios like OTP polling. Returns the single most recent email for a given address.
- **URL**: `GET /api/v1/latest/:address`
- **Auth**: Required
- **Response**:
  ```json
  {
    "id": "email_id_123",
    "subject": "Your Login Code",
    "text": "Your code is 123456...",
    "html": "<body>...</body>",
    "created_at": "2024-12-10T10:00:00Z"
  }
  ```

### 4. Get Inbox
Fetch a list of emails for a specific address.
- **URL**: `GET /api/v1/inbox/:address`
- **Auth**: Required
- **Query Params**: `?limit=10` (Default: 10)

---

## ðŸ”„ Webhooks

The system can be configured to send a HTTP POST request to your `WEBHOOK_URL` whenever a new email arrives.

**Configuration**:
Set `WEBHOOK_URL` in your `wrangler.toml` file.

**Payload Structure**:
```json
{
  "id": "email_uuid",
  "from": "Sender <sender@example.com>",
  "to": "your-alias@your-domain.com",
  "subject": "Email Subject",
  "text": "Plain text content...",
  "html": "HTML content...",
  "headers": { 
    "date": "...",
    "message-id": "..."
  },
  "attachments": [
    {
      "filename": "image.png",
      "contentType": "image/png",
      "size": 1024,
      "url": "https://pub-xxx.r2.dev/..." // If R2 enabled
    }
  ]
}
```

---

## ðŸ“Š Admin API (Planned Phase 4)

*Endpoints currently in development.*

- `GET /api/v1/admin/emails` - List all emails with pagination (`?limit=50&offset=0`).
- `DELETE /api/v1/admin/email/:id` - Delete a specific email.
- `POST /api/v1/admin/emails/delete` - Bulk delete emails. Body: `{ids: string[]}`.
- `GET /api/v1/admin/stats` - Get Admin Stats (Top Senders, Top Receivers).
- `GET /api/v1/admin/export` - Export ALL email data as JSON. 
- `GET /api/v1/admin/blocklist` - Get current blocklist.
- `POST /api/v1/admin/blocklist` - Add to blocklist. Body: `{email: "spammer@bad.com"}` (or `@domain.com`).
- `DELETE /api/v1/admin/blocklist` - Remove from blocklist. Query: `?email=...`

## ðŸ¤– Smart AI Features

- **Smart Reply**: `POST /api/v1/admin/ai/reply`
    - Body: `{ emailId: string, instructions?: string }`
    - Generates a context-aware reply for an email.
- **AI Summary**: `GET /api/v1/ai/summarize/:id`
    - Generates a concise summary of the email logic.
