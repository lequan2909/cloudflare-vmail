---
import DocsLayout from '@/layouts/DocsLayout.astro'
import { CodeBlock } from '@/components/CodeBlock'

const Env = Astro.locals.runtime.env
const baseUrl = Astro.url.origin + '/api/v1'

// Code examples as strings to avoid template literal issues
const nodeExample = `const BASE_URL = '${Astro.url.origin}/api/v1';

// Step 1: Create a temporary mailbox and get access token
async function createMailbox() {
  const response = await fetch(\`\${BASE_URL}/mailbox\`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    }
  });

  const data = await response.json();
  console.log('Mailbox created:', data.mailbox.address);
  console.log('Token:', data.mailbox.token);
  return data.mailbox;
}

// Step 2: Get emails for the mailbox using the token
async function getEmails(mailboxAddress, token) {
  const response = await fetch(
    \`\${BASE_URL}/mailbox/\${mailboxAddress}/emails?limit=10\`,
    {
      headers: {
        'Authorization': \`Bearer \${token}\`
      }
    }
  );

  const data = await response.json();
  console.log(\`Found \${data.total} emails\`);
  return data.emails;
}

// Step 3: Get a specific email
async function getEmail(mailboxAddress, emailId, token) {
  const response = await fetch(
    \`\${BASE_URL}/mailbox/\${mailboxAddress}/emails/\${emailId}\`,
    {
      headers: {
        'Authorization': \`Bearer \${token}\`
      }
    }
  );

  const data = await response.json();
  return data.email;
}

// Usage
(async () => {
  const mailbox = await createMailbox();

  // Wait for emails...
  await new Promise(resolve => setTimeout(resolve, 5000));

  const emails = await getEmails(mailbox.address, mailbox.token);
  if (emails.length > 0) {
    const fullEmail = await getEmail(mailbox.address, emails[0].id, mailbox.token);
    console.log('Email content:', fullEmail.text);
  }
})();`

const pythonExample = `import requests
import time

BASE_URL = '${Astro.url.origin}/api/v1'

# Step 1: Create a temporary mailbox and get access token
def create_mailbox():
    response = requests.post(
        f'{BASE_URL}/mailbox',
        headers={'Content-Type': 'application/json'}
    )
    data = response.json()
    print(f"Mailbox created: {data['mailbox']['address']}")
    print(f"Token: {data['mailbox']['token']}")
    return data['mailbox']

# Step 2: Get emails for the mailbox using the token
def get_emails(mailbox_address, token):
    response = requests.get(
        f'{BASE_URL}/mailbox/{mailbox_address}/emails',
        headers={'Authorization': f'Bearer {token}'},
        params={'limit': 10}
    )
    data = response.json()
    print(f"Found {data['total']} emails")
    return data['emails']

# Step 3: Get a specific email
def get_email(mailbox_address, email_id, token):
    response = requests.get(
        f'{BASE_URL}/mailbox/{mailbox_address}/emails/{email_id}',
        headers={'Authorization': f'Bearer {token}'}
    )
    return response.json()['email']

# Usage
mailbox = create_mailbox()
time.sleep(5)  # Wait for emails

emails = get_emails(mailbox['address'], mailbox['token'])
if emails:
    full_email = get_email(mailbox['address'], emails[0]['id'], mailbox['token'])
    print(f"Email content: {full_email['text']}")`

const curlExample = `# Step 1: Create mailbox and get token
curl -X POST ${Astro.url.origin}/api/v1/mailbox \\
  -H "Content-Type: application/json"

# Response will include:
# {
#   "success": true,
#   "mailbox": {
#     "address": "random123@example.com",
#     "token": "eyJhbGc...",
#     "expiresIn": "7 days"
#   }
# }

# Step 2: List emails (use the token from above)
curl -X GET ${Astro.url.origin}/api/v1/mailbox/random123@example.com/emails \\
  -H "Authorization: Bearer YOUR_TOKEN_HERE"

# Step 3: Get specific email
curl -X GET ${Astro.url.origin}/api/v1/mailbox/random123@example.com/emails/abc123 \\
  -H "Authorization: Bearer YOUR_TOKEN_HERE"

# Step 4: Delete email
curl -X DELETE ${Astro.url.origin}/api/v1/mailbox/random123@example.com/emails/abc123 \\
  -H "Authorization: Bearer YOUR_TOKEN_HERE"`
---

<DocsLayout pageTitle='Developer API' title={`Developer API - ${Env.SITE_NAME}`} description="Complete API documentation for developers">
  <div class="not-prose mb-8">
    <div class="bg-gradient-to-r from-primary/10 via-primary/5 to-transparent border-l-4 border-primary rounded-lg p-6">
      <h1 class="text-4xl font-bold mb-3 text-foreground">Developer API</h1>
      <p class="text-lg text-muted-foreground">
        Build automated workflows and integrations with our RESTful API
      </p>
    </div>
  </div>

  <h2 id="overview">Overview</h2>
  <p>
    The {Env.SITE_NAME} API allows you to programmatically create temporary mailboxes,
    retrieve emails, and manage email data. Perfect for automated testing, CI/CD pipelines,
    and integration workflows.
  </p>

  <div class="not-prose my-6">
    <div class="bg-blue-50 dark:bg-blue-950/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4">
      <div class="flex items-start gap-3">
        <div class="text-blue-600 dark:text-blue-400 mt-0.5">ℹ️</div>
        <div class="text-sm text-blue-800 dark:text-blue-300">
          <strong>Base URL:</strong> <code class="bg-blue-100 dark:bg-blue-900/50 px-2 py-0.5 rounded">{baseUrl}</code>
        </div>
      </div>
    </div>
  </div>

  <h2 id="authentication">Authentication</h2>
  <p>
    The API uses a simple token-based authentication system. When you create a temporary mailbox,
    you receive an access token that is valid for 7 days. Use this token in the <code>Authorization</code> header
    for all subsequent requests.
  </p>

  <h3 id="getting-token">Getting Your Access Token</h3>
  <p>
    No pre-registration required! Simply call the mailbox creation endpoint and you'll receive
    your mailbox address along with an access token.
  </p>

  <div class="not-prose my-4">
    <CodeBlock code={`curl -X POST ${baseUrl}/mailbox \\
  -H "Content-Type: application/json"`} language="bash" client:load />
  </div>

  <h3 id="using-token">Using Your Token</h3>
  <p>
    Include your token in the <code>Authorization</code> header as a Bearer token:
  </p>

  <div class="not-prose my-4">
    <CodeBlock code={`Authorization: Bearer YOUR_TOKEN_HERE`} language="bash" client:load />
  </div>

  <h2 id="token-security">Token Security</h2>
  <div class="not-prose my-4">
    <div class="bg-amber-50 dark:bg-amber-950/20 border border-amber-200 dark:border-amber-800 rounded-lg p-4">
      <div class="flex items-start gap-3">
        <div class="text-amber-600 dark:text-amber-400 mt-0.5">⚠️</div>
        <div class="text-sm text-amber-800 dark:text-amber-300">
          <strong>Important:</strong>
          <ul class="mt-2 space-y-1 list-disc list-inside">
            <li>Tokens are tied to specific mailboxes - you can only access the mailbox that was created with that token</li>
            <li>Tokens expire after 7 days</li>
            <li>Store tokens securely and never commit them to version control</li>
            <li>Each mailbox creation generates a new token</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <h2 id="endpoints">API Endpoints</h2>

  <h3 id="create-mailbox">Create Temporary Mailbox</h3>
  <p>
    Generate a new temporary email address and receive an access token for it.
  </p>

  <div class="not-prose my-4">
    <div class="bg-card border border-border rounded-lg overflow-hidden">
      <div class="bg-muted/50 px-4 py-2 border-b border-border">
        <span class="inline-block bg-green-600 text-white text-xs font-bold px-2 py-1 rounded">POST</span>
        <code class="ml-2 font-mono text-sm">/api/v1/mailbox</code>
      </div>
      <div class="p-4 space-y-4">
        <div>
          <h4 class="text-sm font-semibold mb-2">Request Body (Optional)</h4>
          <CodeBlock code={JSON.stringify({ domain: 'example.com' }, null, 2)} language="json" className="text-xs" client:load />
        </div>
        <div>
          <h4 class="text-sm font-semibold mb-2">Response (201 Created)</h4>
          <CodeBlock code={JSON.stringify({
  success: true,
  mailbox: {
    address: 'random123@example.com',
    token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...',
    expiresIn: '7 days',
    createdAt: '2025-10-03T12:00:00.000Z'
  }
}, null, 2)} language="json" className="text-xs" client:load />
        </div>
      </div>
    </div>
  </div>

  <h3 id="list-emails">List Emails</h3>
  <p>
    Retrieve all emails for a specific mailbox with optional pagination and filtering.
  </p>

  <div class="not-prose my-4">
    <div class="bg-card border border-border rounded-lg overflow-hidden">
      <div class="bg-muted/50 px-4 py-2 border-b border-border">
        <span class="inline-block bg-blue-600 text-white text-xs font-bold px-2 py-1 rounded">GET</span>
        <code class="ml-2 font-mono text-sm">/api/v1/mailbox/:address/emails</code>
      </div>
      <div class="p-4 space-y-4">
        <div>
          <h4 class="text-sm font-semibold mb-2">Headers</h4>
          <CodeBlock code="Authorization: Bearer YOUR_TOKEN_HERE" language="bash" className="text-xs" client:load />
        </div>
        <div>
          <h4 class="text-sm font-semibold mb-2">Query Parameters</h4>
          <ul class="text-sm space-y-1">
            <li><code>limit</code> (number, optional) - Number of emails to return (default: 50, max: 100)</li>
            <li><code>offset</code> (number, optional) - Offset for pagination (default: 0)</li>
            <li><code>unread_only</code> (boolean, optional) - Only return unread emails</li>
          </ul>
        </div>
        <div>
          <h4 class="text-sm font-semibold mb-2">Response (200 OK)</h4>
          <CodeBlock code={JSON.stringify({
  success: true,
  emails: [
    {
      id: 'abc123',
      from: { address: 'sender@example.com', name: 'Sender Name' },
      to: [{ address: 'random123@example.com', name: '' }],
      subject: 'Welcome!',
      date: '2025-10-03T12:00:00.000Z',
      createdAt: '2025-10-03T12:00:00.000Z',
      isRead: false,
      readAt: null,
      priority: 'normal',
      textPreview: 'This is a preview of the email content...',
      hasHtml: true
    }
  ],
  total: 1,
  limit: 50,
  offset: 0
}, null, 2)} language="json" className="text-xs" client:load />
        </div>
      </div>
    </div>
  </div>

  <h3 id="get-email">Get Email Details</h3>
  <p>
    Retrieve complete details of a specific email including full content and headers.
  </p>

  <div class="not-prose my-4">
    <div class="bg-card border border-border rounded-lg overflow-hidden">
      <div class="bg-muted/50 px-4 py-2 border-b border-border">
        <span class="inline-block bg-blue-600 text-white text-xs font-bold px-2 py-1 rounded">GET</span>
        <code class="ml-2 font-mono text-sm">/api/v1/mailbox/:address/emails/:id</code>
      </div>
      <div class="p-4 space-y-4">
        <div>
          <h4 class="text-sm font-semibold mb-2">Headers</h4>
          <CodeBlock code="Authorization: Bearer YOUR_TOKEN_HERE" language="bash" className="text-xs" client:load />
        </div>
        <div>
          <h4 class="text-sm font-semibold mb-2">Response (200 OK)</h4>
          <CodeBlock code={JSON.stringify({
  success: true,
  email: {
    id: 'abc123',
    from: { address: 'sender@example.com', name: 'Sender Name' },
    to: [{ address: 'random123@example.com', name: '' }],
    subject: 'Welcome!',
    messageId: '<abc123@mail.example.com>',
    date: '2025-10-03T12:00:00.000Z',
    text: 'Plain text content...',
    html: '<html>HTML content...</html>',
    headers: [{ 'Content-Type': 'text/html; charset=utf-8' }],
    isRead: false,
    priority: 'normal'
  }
}, null, 2)} language="json" className="text-xs" client:load />
        </div>
      </div>
    </div>
  </div>

  <h3 id="delete-email">Delete Email</h3>
  <p>
    Delete a specific email from the mailbox.
  </p>

  <div class="not-prose my-4">
    <div class="bg-card border border-border rounded-lg overflow-hidden">
      <div class="bg-muted/50 px-4 py-2 border-b border-border">
        <span class="inline-block bg-red-600 text-white text-xs font-bold px-2 py-1 rounded">DELETE</span>
        <code class="ml-2 font-mono text-sm">/api/v1/mailbox/:address/emails/:id</code>
      </div>
      <div class="p-4 space-y-4">
        <div>
          <h4 class="text-sm font-semibold mb-2">Headers</h4>
          <CodeBlock code="Authorization: Bearer YOUR_TOKEN_HERE" language="bash" className="text-xs" client:load />
        </div>
        <div>
          <h4 class="text-sm font-semibold mb-2">Response (200 OK)</h4>
          <CodeBlock code={JSON.stringify({ success: true }, null, 2)} language="json" className="text-xs" client:load />
        </div>
      </div>
    </div>
  </div>

  <h2 id="error-codes">Error Codes</h2>
  <p>
    The API uses standard HTTP status codes to indicate the success or failure of requests.
  </p>

  <div class="not-prose my-4">
    <table class="w-full border border-border rounded-lg overflow-hidden">
      <thead class="bg-muted/50">
        <tr>
          <th class="px-4 py-2 text-left text-sm font-semibold">Status Code</th>
          <th class="px-4 py-2 text-left text-sm font-semibold">Description</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-border">
        <tr>
          <td class="px-4 py-2 text-sm font-mono">200</td>
          <td class="px-4 py-2 text-sm">Success</td>
        </tr>
        <tr>
          <td class="px-4 py-2 text-sm font-mono">201</td>
          <td class="px-4 py-2 text-sm">Created</td>
        </tr>
        <tr>
          <td class="px-4 py-2 text-sm font-mono">400</td>
          <td class="px-4 py-2 text-sm">Bad Request - Invalid parameters</td>
        </tr>
        <tr>
          <td class="px-4 py-2 text-sm font-mono">401</td>
          <td class="px-4 py-2 text-sm">Unauthorized - Invalid or missing token</td>
        </tr>
        <tr>
          <td class="px-4 py-2 text-sm font-mono">403</td>
          <td class="px-4 py-2 text-sm">Forbidden - Token doesn't match mailbox</td>
        </tr>
        <tr>
          <td class="px-4 py-2 text-sm font-mono">404</td>
          <td class="px-4 py-2 text-sm">Not Found - Resource doesn't exist</td>
        </tr>
        <tr>
          <td class="px-4 py-2 text-sm font-mono">500</td>
          <td class="px-4 py-2 text-sm">Internal Server Error</td>
        </tr>
      </tbody>
    </table>
  </div>

  <h2 id="examples">Usage Examples</h2>

  <h3 id="example-nodejs">Node.js Example</h3>
  <CodeBlock code={nodeExample} language="javascript" client:load />

  <h3 id="example-python">Python Example</h3>
  <CodeBlock code={pythonExample} language="python" client:load />

  <h3 id="example-curl">cURL Examples</h3>
  <CodeBlock code={curlExample} language="bash" client:load />

  <h2 id="workflow">Typical Workflow</h2>
  <ol class="space-y-2">
    <li><strong>Step 1:</strong> Create a temporary mailbox - You'll receive an email address and access token</li>
    <li><strong>Step 2:</strong> Use the mailbox address for signup/testing - Give this address to services that need to send you emails</li>
    <li><strong>Step 3:</strong> Poll for emails - Use the access token to check for new emails periodically</li>
    <li><strong>Step 4:</strong> Retrieve email content - Get the full content of emails you're interested in</li>
    <li><strong>Step 5:</strong> Clean up - Delete emails or let the mailbox expire after 7 days</li>
  </ol>

  <h2 id="best-practices">Best Practices</h2>
  <ul>
    <li><strong>Store tokens securely:</strong> Never commit tokens to version control or expose them in client-side code</li>
    <li><strong>Use polling wisely:</strong> When waiting for emails, use reasonable intervals (e.g., 5-10 seconds) to avoid overloading the server</li>
    <li><strong>Handle token expiration:</strong> Tokens expire after 7 days - create a new mailbox if needed</li>
    <li><strong>Clean up:</strong> Delete emails when you're done to save resources</li>
    <li><strong>Error handling:</strong> Always check the response status and handle errors appropriately</li>
    <li><strong>One token per mailbox:</strong> Each mailbox has its own token - you cannot use a token to access other mailboxes</li>
  </ul>

  <h2 id="support">Support</h2>
  <p>
    If you encounter any issues or have questions about the API, please contact us through
    the main website or consult the documentation.
  </p>
</DocsLayout>
