---
import { getCollection, getEntry, render } from 'astro:content'
import DocsLayout from '@/layouts/DocsLayout.astro'

const Env = Astro.locals.runtime.env

const { slug } = Astro.params
if (!slug) {
  return Astro.redirect('/about')
}

// Get the doc entry
const entry = await getEntry('docs', slug)
if (!entry) {
  return Astro.redirect('/404')
}

// Render the MDX content
const { Content, headings } = await render(entry)

// Format the last updated date
const lastUpdated = entry.data.lastUpdated
  ? new Intl.DateTimeFormat('en-US', { year: 'numeric', month: 'long', day: 'numeric' }).format(entry.data.lastUpdated)
  : undefined
---

<DocsLayout
  title={`${entry.data.title} - ${Env.SITE_NAME}`}
  description={entry.data.description}
  pageTitle={entry.data.title}
  lastUpdated={lastUpdated}
  headings={headings}
>
  <Content />
</DocsLayout>
